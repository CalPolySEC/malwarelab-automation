from flask import Flask, abort, request, url_for, redirect, jsonify, Blueprint
from vmware_api import vms
# import vmware_automate
from config import SECRET_KEY

app = Flask(__name__)
app.config['SECRET_KEY'] = SECRET_KEY
app.register_blueprint(vms)
# app.config['vmware'] = vmware_automate.setup()

@app.route('/')
def index():
    return jsonify({'connected': str(app.config.get('vmware', {}).get('esxi', {}).get('host'))})
 
@app.route('/upload', methods=['POST'])
def upload():
    res = {}

    if request.files is None:
        res['status'] = 'Error! No files found in uploaded data!'
    else:
        res['files'] = []
        for filename in request.files:
            print(filename)
            request.files[filename].save(filename)

            res['files'].append(filename)
        res['status'] = 'Successfully downloaded {} files: {}'.format(len(res['files']), res['files'])
    return jsonify(res)

if __name__ == '__main__':
    app.run(debug=True, port='5000')
